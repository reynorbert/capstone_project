@{
    /**/

    Layout = "~/Views/Shared/_LayoutPageAdmin.cshtml";
}


@model IEnumerable<capstone_project.Models.tbl_accounts>

@foreach (var item in Model)
{
    <div class="w3-content" style="">
        <!-- The Grid -->
        <div class="w3-row-padding">

            <div class="row w3-container" style="border-bottom:solid; border-bottom-color:#808080">
                <div class="col-sm-12">
                    <p class="" style="height: 8vh; font-size: 3vh; text-align: left; font-family:'Courier New'"> My Profile</p>
                </div>
            </div>

            <div class="row w3-container" style="margin-top:2%">
                <div class="col-sm-12">
                    <div class="col-sm-5" style="">
                        <p class="" style="height: 8vh; font-size: 3vh; text-align: left; font-family:'Courier New'; text-align:center">
                            <input type="hidden" name="imgSource" id="imgSource">
                            <img src="~/images/accounts/@item.account_id/profile/@item.account_img" style="width:30vw; height:44vh" name="imageContainer" id="imageContainer" alt="Avatar">

                            <input type="file" class="form-control" name="imageSrc" id="imageSrc" onchange="previewFile()" style="margin:3vh"><br>
                        </p>
                    </div>


                    <div class="col-sm-7">
                        <div class="col-sm-12" style="margin-bottom:2vh;  border-bottom:solid; border-bottom-color:gray">
                            <div class="col-sm-12" style="margin-bottom:2vh">
                                <p style="font-size:2.5vh"><i class="fa fa-address-card fa-fw w3-margin-right w3-large w3-text-teal"></i> Personal Information</p>
                            </div>
                            <div class="col-sm-12" style="margin-bottom:2vh">
                                <input style="font-size:2vh; display:none" type="text" class="form-control col-xs-2" id="id" placeholder="First Name" value="@item.tbl_personalInformations.Where(x => x.account_id == item.account_id).FirstOrDefault().account_id">

                                <input style="font-size:2vh" type="text" class="form-control col-xs-2" id="fName" placeholder="First Name" value="@item.tbl_personalInformations.Where(x => x.account_id == item.account_id).FirstOrDefault().personal_firstName">
                            </div>
                            <div class="col-sm-12" style="margin-bottom:2vh">
                                <p><input style="font-size:2vh" type="text" class="form-control" id="lName" placeholder="Last Name" value="@item.tbl_personalInformations.Where(x => x.account_id == item.account_id).FirstOrDefault().personal_lastName"></p>
                            </div>
                        </div>
                        <div class="col-sm-12" style="margin-bottom:2vh;">
                            <div class="col-sm-12" style="margin-bottom:2vh">
                                <p style="font-size:2.5vh"><i class="fa fa-certificate fa-fw w3-margin-right w3-xxlarge w3-text-teal"></i>Credentials</p>
                            </div>
                            <div class="col-sm-12" style="margin-bottom:2vh">
                                <input style="font-size:2vh" type="email" class="form-control col-xs-2" id="email" placeholder="Email" value="@item.account_email">
                            </div>
                            <div class="col-sm-12" style="margin-bottom:2vh">
                                <p><input style="font-size:2vh" type="password" class="form-control" id="acount_password" placeholder="Password" value="@item.account_password"></p>
                            </div>
                            <div class="col-sm-12" style="margin-bottom:2vh">
                                <p><input style="font-size:2vh" type="password" class="form-control" id="re_password" placeholder="Re-Password" value="@item.account_password"></p>
                            </div>


                        </div>
                    </div>
                </div>
                <div class="col-sm-12" style="border-top:solid; border-color:gray; margin-bottom:2vh; margin-top:0vh; border-bottom:solid">
                    <div class="col-sm-12" style="margin-bottom:2vh;margin-top:2vh">
                        <p style="font-size:2.5vh"> <i class="fa fa-university fa-fw w3-margin-right w3-xxlarge w3-text-teal"></i>Company Details</p>
                    </div>
                    @if (item.account_type == 3)
                    {
                        <div class="col-sm-12" style="margin-bottom:2vh">
                            <p><input style="font-size:2vh;" disabled type="text" class="form-control" placeholder="Company Name" id="compName" value="@item.tbl_companies.company_name"></p>
                        </div>
                        <div class="col-sm-12" style="margin-bottom:2vh">
                            <p><input style="font-size:2vh" disabled type="text" class="form-control" placeholder="Company Address" id="compAddress" value="@item.tbl_companies.company_address"></p>
                        </div>
                    }
                    else
                    {
                        <div class="col-sm-12" style="margin-bottom:2vh">
                            <p><input style="font-size:2vh" type="text" class="form-control" placeholder="Company Name" id="compName" value="@item.tbl_companies.company_name"></p>
                        </div>
                        <div class="col-sm-12" style="margin-bottom:2vh">
                            <p><input style="font-size:2vh" type="text" class="form-control" placeholder="Company Address" id="compAddress" value="@item.tbl_companies.company_address"></p>
                        </div>
                    }


                    <div class="col-sm-12" style="margin-bottom:2vh">
                        <p> <input style="font-size:2vh" type="text" class="form-control col-xs-2" id="bankName" placeholder="Bank Provider" value="@item.account_bankName"></p>
                    </div>
                    <div class="col-sm-12" style="margin-bottom:2vh">
                        <p> <input style="font-size:2vh" type="text" class="form-control col-xs-2" id="accountNumber" placeholder="Credit Card Number" value="@item.account_bankNum"></p>
                    </div>

                </div>

                <div class="col-sm-12" style="">
                    <button type="button" class="form-control col-xs-12" style="font-size:2vh;background-color:cornflowerblue;width:100%; color:aliceblue" onclick="update()"> Update Profile  </button>
                </div>
            </div>
        </div>
    </div>
}

<script>
    function previewFile() {
        var preview = document.getElementById("imageContainer");
        var file = document.getElementById("imageSrc").files[0];
        var imageSourceVar = document.getElementById("imgSource");

        var reader = new FileReader();

        reader.addEventListener("load", function () {
            document.getElementById("imageContainer").src = reader.result;
            document.getElementById("imgSource").value = reader.result;
        }, false);

        if (file) {
            reader.readAsDataURL(file);
        }
    }

    function update() {
        var id = document.getElementById("id").value;
        var fName = document.getElementById("fName").value;
        var lName = document.getElementById("lName").value;
        var email = document.getElementById("email").value;
        var password = document.getElementById("acount_password").value;
        var re_password = document.getElementById("re_password").value;
        var img = document.getElementById("imageSrc").value;
        var bankName = document.getElementById("bankName").value;
        var accountNumber = document.getElementById("accountNumber").value;
        var fileInput = document.getElementById('imageSrc');
        var compName = document.getElementById("compName").value;
        var compAddress = document.getElementById("compAddress").value;

        if (password == re_password) {
            $.ajax({
                method: "POST",
                url: "@Url.Action("update_viaAdmin", "Accounts")",
                data: { fName: fName, lName: lName, userame: email, password: password, img: img, bankName: bankName, accountNumber: accountNumber, compName: compName, compAddress: compAddress, id: id },
                success: function (result) {
                    alert("Profile Edited");
                },
                failed: function (result) {
                    console.log("Failed");
                },
            });

            if (fileInput != "" ) {
                EditImg();
            }

        } else {
            alert("Password does not match. Please try again");
        }
    }

    function EditImg() {
        var formdata = new FormData(); //FormData object
        var fileInput = document.getElementById('imageSrc');
        var id = document.getElementById("id").value;

        formdata.append(fileInput.files[0].name, fileInput.files[0]);
        //Creating an XMLHttpRequest and sending
        var xhr = new XMLHttpRequest();
        xhr.open('POST', '/Accounts/EditImageAdmin?id=' + id);
        xhr.send(formdata);
        xhr.onreadystatechange = function () {
            if (xhr.readyState == 4 && xhr.status == 200) {
                //alert(xhr.responseText);
            }
        }
    }

</script>